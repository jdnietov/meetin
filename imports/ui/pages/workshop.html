<template name="workshop">
  {{#if exist}}
  <div class="ui main workshop container">
    <p></p>
    <!-- Name header -->
    {{#unless isEditingName}}
    <h1 class="ui header">{{workshop.name}}
      {{#if isUserOwner workshop.owner}}
      <!-- Edit icon -->
      <a href="#"><i class="small edit name icon"></i></a>
      {{/if}}
      <div class="sub header">creado por
        <a href="/users/{{workshop.owner}}">
          {{getOwnerName workshop.owner}}
        </a></div>
    </h1>
    {{else}}
    <!-- Edit input -->
    <div class="ui big edit action input">
      <input type="text" name="wedit-name" value="{{workshop.name}}"/>
      <button class="ui teal icon save name button"><i class="check icon"></i></button>
    </div><br>
    {{/unless}}

    <!-- Attend button -->
    {{#if currentUser}}
      {{#if isUserAttending}}
        <button class="ui dark-blue join workshop labeled icon button">
          <i class="check icon"></i>
          Estás asistiendo
        </button>
       {{/if}}
    {{else}}
      {{#unless isUserOwner workshop.owner}}
        <button class="ui light-aqua join workshop labeled icon button">
          <i class="right arrow icon"></i>
          Asistir
        </button>
      {{/unless}}
    {{/if}}

    <div class="ui workshop info grid">
      <div class="ten wide column">
        <!-- Descripción, tags -->
        <div class="ui segment">
          <!-- Tags -->
          {{#each workshop.tags}}
            <a data-idx="{{@index}}" class="ui label">
              {{this}}
              {{#if isUserOwner workshop.owner}} <i class="delete tag icon"></i> {{/if}}
            </a>
          {{/each}}

          {{#if isUserOwner workshop.owner}}

            {{#unless isEditingTag}}
              <button class="circular ui teal create tag icon mini button">
                <i class="add icon"></i>
              </button>
            {{else}}
            <!-- Edit input -->
            <div class="ui edit action input">
              <input type="text" name="wedit-tag" value=""/>
              <button class="ui teal icon save tag button"><i class="check icon"></i></button>
            </div>
            <br>
            {{/unless}}
          {{/if}}

          <div class="ui divider"></div>
          <h5 class="ui header">
            ¿Qué se hace en este taller?
            {{#if isUserOwner workshop.owner}}
            <a href="#"><i class="small edit desc icon"></i></a>
            {{/if}}
          </h5>

          {{#with workshop.desc}}
            {{#if isEditingDesc}}
            <div class="ui desc form">
              <div class="field">
                <textarea name="wedit-desc" rows="6" value="{{this}}" placeholder="Descríbete como persona!"></textarea>
              </div>
              <button class="ui save desc button">Guardar</button>
            </div>
            {{else}}
            <p>{{this}}</p>
            {{/if}}
          {{/with}}

          <div class="ui divider"></div>
          <h5 class="ui header">
            ¿Qué hay que traer?
            {{#if isUserOwner workshop.owner}}
            <a href="#"><i class="small edit items icon"></i></a>
            {{/if}}
          </h5>
          {{#with workshop.items}}
            {{#unless isEditingItems}}
              <div class="ui items">
                {{#each this}}
                <div class="item">
                  <i class="check icon"></i>
                  <div class="content">
                    {{this}}
                  </div>
                </div>
                {{/each}}
              </div>
            {{/unless}}
          {{/with}}
          {{#if isEditingItems}}
          <!-- Edit input -->
            <div class="ui items form">  <!-- Lista de cosas para llevar -->
              <div class="ui action input">
                <input name="wedit-item" type="text" placeholder='Lista de cosas para llevar...'/>
                <div class="ui light-aqua add item button">Agregar</div>
              </div>

              <div class="ui message">
                {{#unless workshop.items}}
                <i class="checkmark box icon"></i>Los elementos que agregues aparecerán aquí.
                {{else}}
                  <div class="ui middle aligned relaxed divided list">
                    {{#each workshop.items}}
                    <div class="item" data-idx="{{@index}}">
                      <div class="right floated content">
                        <a href="#"><i class="item delete icon"></i></a>
                      </div>
                      <i class="check icon"></i>
                      <div class="content">
                        {{this}}
                      </div>
                    </div>
                    {{/each}}
                  </div>
                {{/unless}}
              </div>
              <button class="ui save items button">Guardar</button>
            </div>
            <br>
          {{/if}}
        </div>

      </div>
      <div class="six wide column">
        <!-- Participantes -->
        <div class="ui segment">
          <h5 class="ui header">{{lengthOf workshop.participants}} personas asistirán</h5>
          {{#each participantsSliced workshop.participants}}
            <a href="/users/{{this}}">
              <img class="ui avatar image" data-tooltip="{{getUserName this}}" data-position="top center" src="https://robohash.org/{{this.email}}.png?size=30x30" alt="">
            </a>
          {{/each}}
          <!-- Información -->
          <h5 class="ui header">Información</h5>
          <div class="ui items">
            <!-- Dirección -->
            <div class="item">
                {{#unless isEditingAddr}}
                  <i class="home icon"></i>
                  <div class="content">
                    {{workshop.addr}}
                    {{#if isUserOwner workshop.owner}}
                    <a href="#"><i class="small edit addr icon"></i></a>
                    {{/if}}
                  </div>
                {{else}}
                  <!-- Edit input -->
                  <div class="ui edit action input">
                    <input type="text" name="wedit-addr" value="{{workshop.addr}}"/>
                    <button class="ui teal icon save addr button"><i class="check icon"></i></button>
                  </div><br>
                {{/unless}}
            </div>
            <!-- Precio -->
            <div class="item">

              {{#unless isEditingPrice}}
                <i class="dollar icon"></i>
                <div class="content">
                  {{workshop.price}}
                  {{#if isUserOwner workshop.owner}}
                  <a href="#"><i class="small edit price icon"></i></a>
                  {{/if}}
                </div>
              {{else}}
                <!-- Edit input -->
                <div class="ui edit action input">
                  <input type="text" name="wedit-price" value="{{workshop.price}}"/>
                  <button class="ui teal icon save price button"><i class="check icon"></i></button>
                </div><br>
              {{/unless}}
            </div>
          </div>
          <!-- Eliminar -->
          {{#if isUserOwner workshop.owner}}
          <div class="ui accordion">
            <div class="active title">
              <i class="dropdown icon"></i>
              Más opciones
            </div>
            <div class="content">
              <i class="red trash icon"></i>
              <a class="delete event" href="#">Eliminar este evento</a>
            </div>
          </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
  {{> confirmDeleteModal workshopName=workshop.name}}
  {{else}}
  <div class="ui main workshop container">
    <!-- Yelis ponlo bonito :D -->
    <h1 class="ui header">404 - Este taller no existe =( <br> Intenta con alguno de los siguientes talleres</h1>
    <section id="activities">
      {{#if currentUser}}
        {{> userDashboard}}
      {{else}}
        {{> generalDashboard}}
      {{/if}}
    </section>
  </div>

  {{/if}}
</template>


<template name="confirmDeleteModal">
  <div id="confirmDeleteModal" class="ui compact modal">
    <div class="content">
      <h2 class="ui centered header">¿Estás seguro que deseas eliminar tu taller?</h2>
      <center>
        <p>
          El evento {{workshopName}} será eliminado de forma permanente. ¿Deseas continuar?
        </p>
      </center>
    </div>
    <div class="actions">
      <div class="ui left floated button cancel">Cancelar</div>
      <div class="ui red button ok">Eliminar</div>
    </div>
  </div>
</template>
