<template name="workshop">
  {{#with workshop}}
  <div class="main workshop container">
    <header style="background-image: url({{getImageLink}})" class="masthead">
      <div class="overlay"></div>
      <div class="header-content">
        <div class="header-content-inner">
          <!-- Name and created by fields -->
          {{#unless isEditingName}}
          <h2 class="ui inverted header" id="tagline">
            <strong>{{name}}</strong>
            <!-- Edit icon -->
            {{#if isCurrentUserOwner}}
            <a href="#"><i class="small edit name icon"></i></a>
            {{/if}}
            <div class="sub header">creado por
              <a href="/users/{{owner}}">
                {{getUserName owner}}
              </a>
            </div>
          </h2>
          {{else}}
          <!-- Name edit input -->
          <div class="ui big edit action input">
            <input type="text" name="wedit-name" value="{{name}}"/>
            <button class="ui teal icon save name button"><i class="check icon"></i></button>
          </div><br>
          {{/unless}}
          <div class="ui inverted horizontal divider"></div>
          <!-- Attend button -->
          {{#unless isUserAttending}}
            {{#unless isCurrentUserOwner}}
              {{#if capacityAvailable}}
              <button class="ui teal join workshop labeled icon button">
                <i class="right arrow icon"></i>
                Asistir
              </button>
              {{else}}
              <button class="ui orange labeled icon button">
                <i class="right arrow icon"></i>
                No hay cupos
              </button>
              {{/if}}
            {{/unless}}
            {{else}}
            <button class="ui dark-blue join workshop labeled icon button">
              <i class="check icon"></i>
              Estás asistiendo
            </button>
          {{/unless}}
        </div>
      </div>
    </header>

    <div class="ui container">
      <div class="ui workshop info grid">
        <div class="ten wide column">
          <!-- Descripción, tags -->
          <div class="ui segment">
            <!-- Tags -->
            {{#each tags}}
              <a data-idx="{{@index}}" class="ui label">
                {{this}}
                {{#if isCurrentUserOwner}} <i class="delete tag icon"></i> {{/if}}
              </a>
            {{/each}}

            {{#if isCurrentUserOwner}}

              {{#unless isEditingTag}}
                <button class="circular ui teal create tag icon mini button">
                  <i class="add icon"></i>
                </button>
              {{else}}
              <!-- Edit input -->
              <div class="ui edit action input">
                <input type="text" name="wedit-tag" value=""/>
                <button class="ui teal icon save tag button"><i class="check icon"></i></button>
              </div>
              <br>
              {{/unless}}
              <div class="ui divider"></div>
            {{else}}
            {{#if tags}}
            <div class="ui divider"></div>
            {{/if}}
            {{/if}}
            {{#with desc}}
            <h5 class="ui header">
              ¿Qué se hace en este taller?
              {{#if isCurrentUserOwner}}
              <a href="#"><i class="small edit desc icon"></i></a>
              {{/if}}
            </h5>

              {{#if isEditingDesc}}
              <div class="ui desc form">
                <div class="field">
                  <textarea name="wedit-desc" rows="6" value="{{this}}" placeholder="Descríbete como persona!"></textarea>
                </div>
                <button class="ui save desc button">Guardar</button>
              </div>
              {{else}}
              <p>{{this}}</p>
              {{/if}}
            {{/with}}

            {{#with items}}
            <div class="ui divider"></div>
            <h5 class="ui header">
              ¿Qué hay que traer?
              {{#if isCurrentUserOwner}}
              <a href="#"><i class="small edit items icon"></i></a>
              {{/if}}
            </h5>
              {{#unless isEditingItems}}
                <div class="ui items">
                  {{#each this}}
                  <div class="item">
                    <i class="check icon"></i>
                    <div class="content">
                      {{this}}
                    </div>
                  </div>
                  {{/each}}
                </div>
              {{/unless}}
            {{/with}}
            {{#if isEditingItems}}
            <!-- Edit input -->
              <div class="ui items form">  <!-- Lista de cosas para llevar -->
                <div class="ui action input">
                  <input name="wedit-item" type="text" placeholder='Lista de cosas para llevar...'/>
                  <div class="ui light-aqua add item button">Agregar</div>
                </div>

                <div class="ui message">
                  {{#unless items}}
                  <i class="checkmark box icon"></i>Los elementos que agregues aparecerán aquí.
                  {{else}}
                    <div class="ui middle aligned relaxed divided list">
                      {{#each items}}
                      <div class="item" data-idx="{{@index}}">
                        <div class="right floated content">
                          <a href="#"><i class="item delete icon"></i></a>
                        </div>
                        <i class="check icon"></i>
                        <div class="content">
                          {{this}}
                        </div>
                      </div>
                      {{/each}}
                    </div>
                  {{/unless}}
                </div>
                <button class="ui save items button">Guardar</button>
              </div>
              <br>
            {{/if}}
          </div>
          <div class="ui segment">
            <div class="ui comments">
              <h3 class="ui dividing header">Comentarios y preguntas</h3>
              <form class="ui new comment form">
                <div class="field">
                  <textarea name="new-comment" rows="2" placeholder="Añade un comentario..."></textarea>
                </div>
                <div class="ui blue labeled submit icon fluid button">
                  <i class="comment icon"></i> Añadir un comentario
                </div>
              </form>
              {{#each comments}}
              <div class="comment">
                <a class="avatar">
                  <img src="https://robohash.org/default.png?size=300x300">
                </a>
                <div class="content">
                  <a class="author">{{getUserName user}}</a>
                  <div class="metadata">
                    <span class="date">{{datetime createdAt}}</span>
                  </div>
                  <div class="text">
                    {{content}}
                  </div>
                  <!-- <div class="actions">
                    <a class="reply">Reply</a>
                  </div> -->
                </div>
              </div>
              {{/each}}
            </div>
          </div>
        </div>
        <!-- Menú de información del evento -->
        <div class="six wide column">
          <!-- Participantes -->
          <div class="ui segment" style="padding:30px;">
            {{#unless isCurrentUserOwner}}
            <center>
              <button class="ui email organizer light-red-orange icon labeled button">
                <i class="comment icon"></i>
                Escríbele al organizador
              </button>
              <br><br>
              <form action="" class="ui email form segment" style="display:none;background-color: #f2f2f2;">
                <div class="field">
                  <label>Envía tus preguntas y comentarios al organizador de este evento</label><br>
                  <textarea id="emailToOwner" name="name" rows="8" cols="80"></textarea>
                </div>
                <div class="ui blue send email button">
                  <i class="send icon"></i>
                  Enviar
                </div>
              </form>
            </center>
            <div class="ui fluid success hidden message">
              Tu mensaje fue enviado con éxito.
            </div>
            {{/unless}}
            <h5 class="ui header">{{lengthOf participants}} personas asistirán</h5>
            {{#each firstParticipants participants}}
            <a href="/users/{{this}}">
              <img class="ui named avatar image" data-content="{{getUserName this}}" data-position="bottom center" src="{{profilePicSrc this}}" alt="">
            </a>
            {{/each}}
            {{#if remain participants}}
            <a class="watch participants" href="#">Ver más...</a>
            {{/if}}
            <!-- Información -->
            <h5 class="ui header">Información</h5>
            <div class="ui items">
              <!-- Dirección -->
              <div class="item">
                  {{#unless isEditingAddr}}
                    <i class="home icon"></i>
                    <div class="content">
                      {{addr}}
                      {{#if isCurrentUserOwner}}
                      <a href="#"><i class="small edit addr icon"></i></a>
                      {{/if}}
                    </div>
                  {{else}}
                    <!-- Edit input -->
                    <div class="ui edit action input">
                      <input type="text" name="wedit-addr" value="{{addr}}"/>
                      <button class="ui teal icon save addr button"><i class="check icon"></i></button>
                    </div><br>
                  {{/unless}}
              </div>
              <!-- Precio -->
              <div class="item">
                {{#unless isEditingPrice}}
                  <i class="dollar icon"></i>
                  <div class="content">
                    {{price}}
                    {{#if isCurrentUserOwner}}
                    <a href="#"><i class="small edit price icon"></i></a>
                    {{/if}}
                  </div>
                {{else}}
                  <!-- Edit input -->
                  <div class="ui edit action input">
                    <input type="number" name="wedit-price" value="{{price}}" min="0" step="100"/>
                    <button class="ui teal icon save price button"><i class="check icon"></i></button>
                  </div><br>
                {{/unless}}
              </div>
              <!-- Cupos -->
              <div class="item">
                {{#unless isEditingCapacity}}
                  <i class="users icon"></i>
                  <div class="content">
                    {{capacity}}
                    {{#if isCurrentUserOwner}}
                    <a href="#"><i class="small edit capacity icon"></i></a>
                    {{/if}}
                  </div>
                {{else}}
                  <!-- Edit input -->
                  <div class="ui edit action input">
                    <input type="number" name="wedit-capacity" value="{{capacity}}" min="1" max="50"/>
                    <button class="ui teal icon save capacity button"><i class="check icon"></i></button>
                  </div><br>
                {{/unless}}
              </div>
              <!-- Fecha -->
              <div class="item">
                {{#unless isEditingInitDate}}
                  <i class="calendar icon"></i>
                  <div class="content initDate">
                    {{styleDate initDate}}
                    {{#if isCurrentUserOwner}}
                      <a href="#"><i class="small edit initDate icon"></i></a>
                    {{/if}}
                  </div>
                {{else}}
                  <!-- Edit input -->
                  <div class="ui edit action input">
                    <!-- <label>Fecha inicial</label> -->
                    <div class="ui calendar" id="initDate">
                      <div class="ui input left icon">
                        <i class="calendar icon"></i>
                        <input type="text" name="wedit-initDate" value="{{initDate}}">
                      </div>
                    </div>
                  </div><br>
                {{/unless}}
              </div>
              <div class="item">
                {{#unless isEditingInitTime}}
                  <i class="time icon"></i>
                  <div class="content endDate">
                    {{formatTime initTime}}
                    {{#if isCurrentUserOwner}}
                      <a href="#"><i class="small edit initTime icon"></i></a>
                    {{/if}}
                  </div>
                {{else}}
                  <!-- Edit input -->
                  <div class="ui edit action input">
                    <!-- <label>Fecha inicial</label> -->
                    <div class="ui calendar" id="initTime">
                      <div class="ui input left icon">
                        <i class="calendar icon"></i>
                        <input type="text" name="wedit-initTime" value="{{initTime}}">
                      </div>
                    </div>
                  </div><br>
                {{/unless}}
              </div>
              <div class="item">
                {{#unless isEditingEndTime}}
                  <i class="time icon"></i>
                  <div class="content endTime">
                    {{formatTime endTime}}
                    {{#if isCurrentUserOwner}}
                      <a href="#"><i class="small edit endTime icon"></i></a>
                    {{/if}}
                  </div>
                {{else}}
                  <!-- Edit input -->
                  <div class="ui edit action input">
                    <!-- <label>Fecha inicial</label> -->
                    <div class="ui calendar" id="endTime">
                      <div class="ui input left icon">
                        <i class="calendar icon"></i>
                        <input type="text" name="wedit-endTime" value="{{endTime}}">
                      </div>
                    </div>
                  </div><br>
                {{/unless}}
              </div>

            </div>

            <!-- Eliminar -->
            {{#if isCurrentUserOwner}}
            <i class="red trash icon"></i>
            <a class="delete event" href="#">Eliminar este evento</a>

            <!-- <div class="ui accordion">
              <div class="title">
                <i class="dropdown icon"></i>
                Más opciones
              </div>
              <div class="content">
                <i class="red trash icon"></i>
                <a class="delete event" href="#">Eliminar este evento</a>
              </div>
            </div> -->
            {{/if}}
          </div>
        </div>
      </div>
    </div>
  </div>

  {{> confirmDeleteModal workshopName=name}}
  {{> participantsModal list=participants}}
  {{else}}
  <div class="ui main workshop container">
    <!-- Yelis ponlo bonito :D -->
    <h1 class="ui header">404 - Este taller no existe =( <br> Intenta con alguno de los siguientes talleres</h1>
    <section id="activities">
      {{#if currentUser}}
        {{> userDashboard}}
      {{else}}
        {{> generalDashboard}}
      {{/if}}
    </section>
  </div>

  {{/with}}
</template>

<template name="participantsModal">
  <div id="participantsModal" class="ui modal">
    <div class="content">
      <h2 class="ui centered header">Lista de participantes</h2>
      <div class="ui middle aligned relaxed divided list">
        {{#each list}}
        <div class="item">
        <img class="ui avatar image" data-position="bottom center" src="{{profilePicSrc this}}">
          <div class="content">
            <b><a href="/users/{{this}}">
              {{getUserName this}}
            </a></b>
          </div>
        </div>
        {{/each}}
      </div>
    </div>
  </div>
</template>

<template name="confirmDeleteModal">
  <div id="confirmDeleteModal" class="ui compact modal">
    <div class="content">
      <h2 class="ui centered header">¿Estás seguro que deseas eliminar tu taller?</h2>
      <center>
        <p>
          El evento {{workshopName}} será eliminado de forma permanente. ¿Deseas continuar?
        </p>
      </center>
    </div>
    <div class="actions">
      <div class="ui left floated button cancel">Cancelar</div>
      <div class="ui red button ok">Eliminar</div>
    </div>
  </div>
</template>
